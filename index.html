<!DOCTYPE html>
<html lang="en">
<head>
    <script src="numeric-1.2.6.js" type="text/javascript"></script>
    <script src="math.js" type="text/javascript"></script>
    <script src="fixeddata.js" type="text/javascript"></script>
    <meta charset="UTF-8">
    <title>Trait Introgression</title>
    <script type="application/javascript">
        var colorA = "#ffff00"; //1
        var colorB = "#8888ff"; //0
        var colorC = "#000000"; //text
        var colorH = "#ffff00"; //highlight
        var w = window.innerWidth;
        var h = window.innerHeight;

        function main() {
            var Data_All_Generations = [] ;
            var H_All_Generations = [] ;
            var Selected_All_Generations = [];
            var Generation_Pointer = 0 ;
            var Generation_Till_Now = 1;
            var m = 20 ;
            var n = 10 ;
            var Data = numeric.random([2*m,n]) ;
            Data = numeric.leq(Data, 0.5);
            for (var i = 0; i<m;i++)
            {
                Data[2*i+1] = Data[2*i];
            }
            Data = FixedData;
            var Selected_Parents_Index= [-1,-1] ;
            var H = getH(Data, m, n) ;
            var SortedIndex =sortWithIndex(H) ;
            var SortedH    = reindexData(H, SortedIndex) ;
            var SortedData = reindexData(Data, SortedIndex) ;
            H = SortedH ;
            Data = SortedData ;
            H_All_Generations.push(H);
            Data_All_Generations.push(Data) ;
            var UnitW = Math.floor(w / (3 * m + 1));
            var UnitH = Math.floor(2 * h / 3 / (n + 1));
            var FontSize = (UnitW < UnitH) ? UnitW : UnitH;
            var Canvas_For_Data = document.createElement("CANVAS") ;
            Canvas_For_Data.id = "Canvas_For_Data";
            Canvas_For_Data.style.left=0+"px";
            Canvas_For_Data.style.top =UnitH+"px";
            Canvas_For_Data.height =  UnitH*(n+1) ;
            Canvas_For_Data.width  =  w ;
            Canvas_For_Data.style.position = "absolute";
            var Canvas_For_Data_Draw = Canvas_For_Data.getContext("2d") ;
            for (var i=0; i<m; i++)
            {
                Canvas_For_Data_Draw.font = FontSize+"px Arial";
                Canvas_For_Data_Draw.textAlign = "center";
                Canvas_For_Data_Draw.fillText(H[i],(3*i+2)*UnitW, (0.5)*UnitH);
                var LocalData = numeric.rep([2, n], 0);
                LocalData[0] = Data[2*i] ;
                LocalData[1] = Data[2*i+1] ;
                for (var j = 0 ; j<n; j++)
                {
                    var LocalColor = (LocalData[0][j] > 0.5) ? colorA:colorB ;
                    if(numeric.sum(LocalData) == 2*n)
                    {
                        LocalColor = colorH ;
                    }
                    Canvas_For_Data_Draw.fillStyle = LocalColor ;
                    Canvas_For_Data_Draw.fillRect   ((3*i+1)*UnitW, (j+1)*UnitH, UnitW, UnitH);
                    var LocalColor = (LocalData[1][j] > 0.5) ? colorA:colorB ;
                    // if all the data are 1, then highlight them to colorH
                    if(numeric.sum(LocalData) == 2*n)
                    {
                        LocalColor = colorH ;
                    }
                    Canvas_For_Data_Draw.fillStyle = LocalColor ;
                    Canvas_For_Data_Draw.fillRect   ((3*i+2)*UnitW, (j+1)*UnitH, UnitW, UnitH);
                    Canvas_For_Data_Draw.fillStyle = colorC;
                    Canvas_For_Data_Draw.strokeRect ((3*i+1)*UnitW, (j+1)*UnitH, UnitW, UnitH);
                    Canvas_For_Data_Draw.strokeRect ((3*i+2)*UnitW, (j+1)*UnitH, UnitW, UnitH);
                }
                var Checkbox__For_Data = document.createElement('input');
                Checkbox__For_Data.type = "checkbox";
                Checkbox__For_Data.name = "name";
                Checkbox__For_Data.value = "value";
                Checkbox__For_Data.id = i+"_Checkbox__For_Data";
                Checkbox__For_Data.style.position = "absolute";
                Checkbox__For_Data.style.left     = (3*i+2)*UnitW-UnitW/2+"px";
                Checkbox__For_Data.style.top      = UnitH*(n+2.2)+"px";
                Checkbox__For_Data.height = UnitH ;
                Checkbox__For_Data.width  = UnitW*2 ;
                Checkbox__For_Data.checked = false ;
                Checkbox__For_Data.onclick = function()
                {
                    Selected_Parents_Index = scanCheckbox(m);
                };
                document.body.appendChild(Checkbox__For_Data);

            }
            document.body.appendChild(Canvas_For_Data);
            drawData(SortedData, SortedH, m, n) ;
            var Checkbox_For_PCV_Select = document.createElement('input') ;
            Checkbox_For_PCV_Select.type = "checkbox";
            Checkbox_For_PCV_Select.name = "name";
            Checkbox_For_PCV_Select.value = "value";
            Checkbox_For_PCV_Select.id = "Checkbox_For_PCV_Select";
            Checkbox_For_PCV_Select.style.position = "absolute";
            Checkbox_For_PCV_Select.style.left     = (2)*UnitW+"px";
            Checkbox_For_PCV_Select.style.top      = 0.8*h+"px";
            Checkbox_For_PCV_Select.height = UnitH ;
            Checkbox_For_PCV_Select.width  = UnitW*2 ;
            Checkbox_For_PCV_Select.checked = false ;
            Checkbox_For_PCV_Select.onclick = function()
            {
                var Selected_Parents_Index = PCV_Selection(Data, m);
            };
            document.body.appendChild(Checkbox_For_PCV_Select);
            var Label_PCV_Text = "Predicted Cross Value Selection" ;
            var Label_PCV_Select = document.createElement('label') ;
            Label_PCV_Select.style.position = "absolute" ;
            Label_PCV_Select.style.left     = (3)*UnitW+"px";
            Label_PCV_Select.style.top      = 0.8*h+"px";
            Label_PCV_Select.style.height   = UnitH ;
            Label_PCV_Select.style.width    = UnitW*2 ;
            Label_PCV_Select.style.textAlign = "left";
            Label_PCV_Select.style.color = "red";
            Label_PCV_Select.style.fontWeight = "bold" ;
            Label_PCV_Select.htmlFor = "id";
            Label_PCV_Select.id = "Label_PCV_Select" ;
            Label_PCV_Select.appendChild(document.createTextNode(Label_PCV_Text));
            document.body.appendChild(Label_PCV_Select);
            var ButtonNames = ["Cross", "-", "+", "Reset"];
            var ButtonW = w/(2*ButtonNames.length+1);
            var ButtonH = UnitH ;
            var label = document.createElement('label') ;
            label.style.position = "absolute" ;
            label.style.left     = ButtonW*4+"px";
            label.style.top      = 0.9*h+"px";
            label.style.height   = ButtonH +"px";
            label.style.width    = ButtonW +"px";
            label.style.textAlign = "center";
            label.style.fontSize = ButtonH + "px";
            label.style.fontWeight = "bold" ;
            label.htmlFor = "id";
            label.id = "Label" ;
            label.appendChild(document.createTextNode("G0"));
            document.body.appendChild(label);
            for (var i = 0 ; i <4; i++)
            {
                var button = document.createElement("BUTTON");
                button.style.position = "absolute";
                button.style.left     = ButtonW*(2*i+1)+"px";
                button.style.top      = 0.9*h+"px";//h/3+"px";
                button.style.height = ButtonH +"px" ;
                button.style.width  = ButtonW +"px";
                button.style.fontSize = ButtonH/2 + "px";
                button.style.fontWeight = "bold" ;
                button.setAttribute('content', 'test content');
                button.innerHTML = ButtonNames[i];
                button.id = i+"_button" ;
                if (i+1==4)
                {
                    button.style.color = "red" ;
                    button.onclick = function()
                    {
                        var Text_M = document.getElementById("InputBox_M").value ;
                        var Text_N = document.getElementById("InputBox_N").value ;
                        m = parseInt(Text_M) ;
                        n = parseInt(Text_N) ;
                        var NewSortedData = reset(m, n);
                        Data = NewSortedData[0];
                        H    = NewSortedData[1];
                        Data_All_Generations = [] ;
                        Data_All_Generations.push(Data) ;
                        H_All_Generations = [];
                        H_All_Generations.push(H) ;
                        Generation_Pointer = 0 ;
                        Generation_Till_Now = 1;
                        var temLabel = document. getElementById("Label") ;
                        var temLabelIndex = Generation_Till_Now-1 ;
                        temLabel.innerHTML = "G"+ temLabelIndex;
                    }
                }
                if (i+1==1)
                {
                    button.onclick = function()
                    {
                        var MN = setMN() ;
                        m = MN[0];
                        n = MN[1];
                        var k = m;
                        var Selected_Parents_Index= scanCheckbox(m) ;

                        if (Selected_Parents_Index[0]==-1 && Selected_Parents_Index[1]==-1)
                        {

                        }
                        else
                        {
                            var L1 = numeric.rep([2, n], 0);
                            var L2 = numeric.rep([2, n], 0);
                            var Index_0 = Selected_Parents_Index[0] ;
                            L1[0] = Data[2*Index_0] ;
                            L1[1] = Data[2*Index_0+1] ;
                            var Index_1 = Selected_Parents_Index[1] ;
                            L2[0] = Data[2*Index_1] ;
                            L2[1] = Data[2*Index_1+1] ;
                            var NewRawData = performCrossOperation(L1, L2, r, k) ;
                            var NewRawH    = getH(NewRawData);
                            var SortedIndex_NewRawH = sortWithIndex(NewRawH) ;
                            H = reindexData(NewRawH, SortedIndex_NewRawH) ;
                            Data = reindexData(NewRawData, SortedIndex_NewRawH);
                            drawData(Data, H, m, n) ;
                            Data_All_Generations.push(Data) ;
                            H_All_Generations.push(H) ;
                            Generation_Pointer  = Generation_Pointer + 1 ;
                            Generation_Till_Now = Generation_Till_Now+ 1 ;
                            var temLabel = document. getElementById("Label") ;
                            var temLabelIndex = Generation_Till_Now-1 ;
                            temLabel.innerHTML = "G"+ temLabelIndex;
                            var checkBox ;
                            for (var i = 0; i<m; i++) {
                                checkBox = document.getElementById(i+"_Checkbox__For_Data");
                                checkBox.disabled  = false ;
                                checkBox.checked   = false;
                            }
                            checkBox = document.getElementById("Checkbox_For_PCV_Select");
                            checkBox.checked = false;
                        }
                    }
                }
                if (i+1==2)
                {
                    button.onclick = function()
                    {
                        Generation_Pointer = Generation_Pointer -1 ;
                        if (Generation_Pointer < 0)
                        {
                            Generation_Pointer = 0 ;
                        }
                        var LocalData2Plot = Data_All_Generations[Generation_Pointer];
                        var LocalH2Plot    = H_All_Generations[Generation_Pointer];
                        var localSize_tem = numeric.dim(LocalData2Plot) ;
                        n = localSize_tem[1];
                        m = LocalH2Plot.length ;
                        drawData(LocalData2Plot, LocalH2Plot, m, n) ;
                        var temLabel = document. getElementById("Label") ;
                        temLabel.innerHTML = "G"+ Generation_Pointer;
                    }
                }
                if (i+1==3)
                {
                    button.onclick = function()
                    {
                        Generation_Pointer = Generation_Pointer + 1 ;
                        if (Generation_Pointer +1 >= Generation_Till_Now)
                        {
                            Generation_Pointer = Generation_Till_Now - 1 ;
                        }
                        var LocalData2Plot = Data_All_Generations[Generation_Pointer];
                        var LocalH2Plot    = H_All_Generations[Generation_Pointer];
                        var localSize_tem = numeric.dim(LocalData2Plot) ;
                        n = localSize_tem[1];
                        m = LocalH2Plot.length ;
                        drawData(LocalData2Plot, LocalH2Plot, m, n) ;
                        var temLabel = document. getElementById("Label") ;
                        temLabel.innerHTML = "G"+ Generation_Pointer;

                    }
                }
                document.body.appendChild(button);
            }
            var Label_M_Text = "Population Number (M, integer) : " ;
            var Label_M = document.createElement('label') ;
            Label_M.style.position = "absolute" ;
            Label_M.style.left    = 0+"px";
            Label_M.style.top     = h/6+"px";
            Label_M.style.height  = h/12 +"px";
            Label_M.style.width   = w/3 +"px";
            Label_M.style.textAlign = "right";
            Label_M.htmlFor = "id";
            Label_M.id = "Label_M" ;
            Label_M.style.visibility = "hidden";
            Label_M.appendChild(document.createTextNode(Label_M_Text));
            document.body.appendChild(Label_M);
            var Label_N_Text = "Gene Group Number (N, integer) : " ;
            var Label_N = document.createElement('label') ;
            Label_N.style.position = "absolute" ;
            Label_N.style.left     = 0+"px";
            Label_N.style.top      = h/6+h/12+"px";
            Label_N.style.height   = h/12 +"px";
            Label_N.style.width    = w/3 +"px";
            Label_N.style.textAlign = "right";
            Label_N.htmlFor = "id";
            Label_N.id = "Label_N" ;
            Label_N.style.visibility = "hidden";
            Label_N.appendChild(document.createTextNode(Label_N_Text));
            document.body.appendChild(Label_N);
            var InputBox_M = document.createElement('input');
            InputBox_M.type = "text";
            InputBox_M.value = m;
            InputBox_M.id = "InputBox_M";
            InputBox_M.style.position = "absolute";
            InputBox_M.style.left     = 10+w/3 +"px";
            InputBox_M.style.top      = h/6+"px";
            InputBox_M.size = 4;
            InputBox_M.maxLength = 3;
            InputBox_M.style.visibility = "hidden";
            document.body.appendChild(InputBox_M);
            var InputBox_N = document.createElement('input');
            InputBox_N.type = "text";
            InputBox_N.value = n;
            InputBox_N.id = "InputBox_N";
            InputBox_N.style.position = "absolute";
            InputBox_N.style.left     = 10+w/3 +"px";
            InputBox_N.style.top      = h/6+h/12+"px";
            InputBox_N.size  = 4;
            InputBox_N.maxLength = 3;
            InputBox_N.style.visibility = "hidden";
            document.body.appendChild(InputBox_N);
            var Button_SetMN = document.createElement("BUTTON");
            Button_SetMN.style.position = "absolute";
            Button_SetMN.style.left     = 2*w/5 +"px";
            Button_SetMN.style.top      = h/6+"px";
            Button_SetMN.style.height = h/12 +"px" ;
            Button_SetMN.style.width  = w/6 +"px";
            Button_SetMN.style.fontWeight = "bold" ;
            Button_SetMN.innerHTML = "set M and N values";
            Button_SetMN.id = "Button_SetMN" ;
            Button_SetMN.style.visibility = "hidden";
            Button_SetMN.onclick = function()
            {
                deleteOldCheckBox(m);
                var MN = setMN();
                m = MN[0] ;
                n = MN[1] ;
                UnitW = Math.floor(w / (3 * m + 1));
                UnitH = Math.floor(2 * h / 3 / (n + 1));
                FontSize = (UnitW < UnitH) ? UnitW : UnitH;
                var NewInitial_Data = numeric.random([2*m, n]);
                NewInitial_Data = numeric.leq(NewInitial_Data, 0.5);
                for (var i = 0 ; i< m ; i++ )
                    NewInitial_Data[2*i+1] = NewInitial_Data[2*i] ;
                var NewInitial_H    = getH(NewInitial_Data,m,n) ;
                var NewInitial_SortedIndex = sortWithIndex(NewInitial_H) ;
                sortedDrawData(NewInitial_Data, NewInitial_H, m, n, NewInitial_SortedIndex) ;
                Data_All_Generations = [];
                H_All_Generations = [];
                Data = reindexData(NewInitial_Data, NewInitial_SortedIndex);
                H    = reindexData(NewInitial_H, NewInitial_SortedIndex) ;
                Data_All_Generations.push(Data);
                H_All_Generations.push(H) ;
                Generation_Till_Now = 1 ;
                Generation_Pointer  = 0 ;
                var tem___Label = document. getElementById("Label") ;
                tem___Label.innerHTML = "G0";
            };
            document.body.appendChild(Button_SetMN);
            var button_ResetMN = document.createElement("BUTTON");
            button_ResetMN.style.position = "absolute";
            button_ResetMN.style.left     = 3*w/5 +"px";
            button_ResetMN.style.top      = h/6+"px";
            button_ResetMN.style.height = h/12 +"px" ;
            button_ResetMN.style.width  = w/6 +"px";
            button_ResetMN.style.fontWeight = "bold" ;
            button_ResetMN.style.color = "red" ;
            button_ResetMN.innerHTML = "reset M and N values";
            button_ResetMN.id = "Button_ResetMN" ;
            button_ResetMN.style.visibility = "hidden";
            button_ResetMN.onclick = function()
            {
                document.getElementById("Button_SetMN").disabled = false ;
                resetMN();
                Data = [] ;
                H = [] ;
                Generation_Pointer = 0 ;
                Generation_Till_Now = 1 ;
                var tem___Label = document. getElementById("Label") ;
                tem___Label.innerHTML = "G0";
            };
            document.body.appendChild(button_ResetMN);
        }
        function reindexData(H, SortedIndex)
        {
            var LocalIndex;
            if (H.length == SortedIndex.length) {
                var ReturnH = numeric.rep(numeric.dim(H), 0);
                for (var i = 0; i < ReturnH.length; i++) {
                    LocalIndex=SortedIndex[i] ;
                    ReturnH[i] = H[LocalIndex];
                }
                return ReturnH;
            }
            else {
                var Data = H;
                var ReturnData = numeric.rep(numeric.dim(Data), 0);
                for (var i = 0; i < SortedIndex.length; i++) {
                    LocalIndex = SortedIndex[i];
                    ReturnData[2 * i] = Data[2 * LocalIndex];
                    ReturnData[2 * i+1] = Data[2 * LocalIndex+1];
                }
                return  ReturnData ;
            }
        }
        function PCV_Selection(Data, m)
        {
            var MN = setMN();
            m = MN[0] ;
            n = MN[1] ;
            var checkBox = document.getElementById("Checkbox_For_PCV_Select");
            var PCVStatus = checkBox.checked ;
            if (!PCVStatus)
            {
                var Selected_Parents_Index = scanCheckbox(m);
                return Selected_Parents_Index ;
            }
            var LVS = numeric.rep ([m, m], 0) ;
            var LocalMax = 0;
            var LocalMaxI=0 ;
            var LocalMaxJ=0 ;
            var R = numeric.rep([n-1], 0);
            for (var i = 0; i<n-1; i++)
            {
                if (i%2 == 0)
                {R[i] = 0.1;}
                else
                {R[i] = 0.2;}
            }
            var TM = [];
            var temTM = numeric.rep([4,4], 0);
            for (var i = 0; i<R.length; i++)
            {
                r= R[i] ;
                temTM[1-1][1-1] = (1-r)*(1-r);
                temTM[1-1][2-1] = (1-r)*r;
                temTM[1-1][3-1] = 0.5*r;
                temTM[1-1][4-1] = 0.5*r;
                temTM[2-1][1-1] = (1-r)*r;
                temTM[2-1][2-1] = (1-r)*(1-r);
                temTM[2-1][3-1] = 0.5*r;
                temTM[2-1][4-1] = 0.5*r;
                temTM[3-1][1-1] = 0.5*r;
                temTM[3-1][2-1] = 0.5*r;
                temTM[3-1][3-1] = (1-r)*(1-r);
                temTM[3-1][4-1] = (1-r)*r;
                temTM[4-1][1-1] = 0.5*r;
                temTM[4-1][2-1] = 0.5*r;
                temTM[4-1][3-1] = (1-r)*r;
                temTM[4-1][4-1] = (1-r)*(1-r);
                TM.push(temTM);
            }
            for (var i = 0 ; i<m; i++)
                for (var j =i ; j<m; j++)
                {
                    var Parents = numeric.rep([4,n], 0) ;
                    Parents[0] = Data[2*i] ;
                    Parents[1] = Data[2*i+1] ;
                    Parents[2] = Data[2*j] ;
                    Parents[3] = Data[2*j+1] ;
                    Parents = numeric.transpose(Parents);
                    var W = numeric.rep([n, 4] , 0) ;
                    W[0] = numeric.div(Parents[0], 4) ;
                    for (var id = 1; id< n ; id++)
                    {
                        var tem = numeric.dotVM(W[id-1],TM[id-1]) ;
                        W[id] = numeric.mul(Parents[id], tem) ;
                    }
                    LVS[i][j] = numeric.sum(W[n-1]) ;
                    if (LVS[i][j]>LocalMax)
                    {
                        LocalMax  = LVS[i][j] ;
                        LocalMaxI = i ;
                        LocalMaxJ = j ;
                    }
                }
            var SelectedIndexTem = [LocalMaxI, LocalMaxJ] ;
            var SelectedIndex = [2,10] ;
            SelectedIndex = SelectedIndexTem ;
            if (document.getElementById("Checkbox_For_PCV_Select").checked == true)
            {
                for (var i = 0; i<m; i++)
                {
                    document.getElementById(i+"_Checkbox__For_Data").disabled = false ;
                    document.getElementById(i+"_Checkbox__For_Data").checked = false ;
                    if (i == SelectedIndex[0] || i == SelectedIndex[1])
                        document.getElementById(i+"_Checkbox__For_Data").checked = true ;
                    else
                        document.getElementById(i+"_Checkbox__For_Data").disabled = true ;
                }
                return SelectedIndex;
            }
            else
            {
                for (var i = 0; i<m; i++)
                {
                    document.getElementById(i+"_Checkbox__For_Data").disabled = false ;
                    document.getElementById(i+"_Checkbox__For_Data").checked = false ;
                }
                return [-1, -1] ;
            }
        }
        function scanCheckbox(m)
        {
            var SelectedIndex =[-1 , -1];
            var statusList = numeric.linspace(0, m-1);
            var TotalSelected = 0 ;
            for (var i = 0; i<m; i++)
            {
                if (document.getElementById(i+"_Checkbox__For_Data").checked == true)
                {
                    TotalSelected = TotalSelected + 1 ;
                    statusList[i] = 1;
                }
                else
                {
                    statusList[i] = 0;
                }
                if (TotalSelected == 2)
                {
                    for (var j=0; j<m; j++)
                    {
                        if(document.getElementById(j+"_Checkbox__For_Data").checked == false)
                            document.getElementById(j+"_Checkbox__For_Data").disabled = true ;
                    }
                    break ;
                }
                else
                {
                    for (var j=0; j<m; j++)
                        document.getElementById(j+"_Checkbox__For_Data").disabled = false ;
                }
            }

            if (TotalSelected==2)
            {
                var k = 0;
                for(i = 0; i<m; i++)
                {
                    if (document.getElementById(i+"_Checkbox__For_Data").checked == true)
                    {SelectedIndex[k] = i; k=k+1;}
                }
                return SelectedIndex;
            }
            if (TotalSelected==1)
            {
                var k = 0;
                for(i = 0; i<m; i++)
                {
                    if (document.getElementById(i+"_Checkbox__For_Data").checked == true)
                    {SelectedIndex[k] = i; k=k+1;}
                }
                SelectedIndex[k] = SelectedIndex[k-1] ;
                return SelectedIndex;
            }
            if (TotalSelected==0)
            {
                return [-1, -1] ;
            }
        }

        function deleteOldCheckBox(m)
        {
            for (var i = 0 ; i < m ; i++)
            {
                var TemCheckBox = document.getElementById(i+"_Checkbox__For_Data") ;
                if (TemCheckBox==null)
                    continue;
                TemCheckBox.parentNode.removeChild(TemCheckBox);
            }
        }
        function setMN()
        {
            var Text_M = document.getElementById("InputBox_M").value ;
            var Text_N = document.getElementById("InputBox_N").value ;
            var M = parseInt(Text_M) ;
            var N = parseInt(Text_N) ;
            if (M <= 0 || N<=0)
            {
                alert("value of M or N cannot be less than zero. set default value m = 20 , n = 10") ;
                document.getElementById("InputBox_M").value = 20 ;
                document.getElementById("InputBox_N").value = 10 ;
                M = 20 ;
                N = 10 ;
                document.getElementById("InputBox_M").disabled = true;
                document.getElementById("InputBox_N").disabled = true;
                document.getElementById("Button_SetMN").disabled = true;
                return [M, N] ;
            }
            if (M > 40 || N > 40)
            {
                alert("value of M or N cannot be larger than 40 due to computer memory cost. set default value m = 20 , n = 10") ;
                document.getElementById("InputBox_M").value = 20 ;
                document.getElementById("InputBox_N").value = 10 ;
                M = 20 ;
                N = 10 ;
                document.getElementById("InputBox_M").disabled = true;
                document.getElementById("InputBox_N").disabled = true;
                document.getElementById("Button_SetMN").disabled = true;
                return [M, N] ;
            }
            document.getElementById("InputBox_M").value = M ;
            document.getElementById("InputBox_N").value = N ;
            document.getElementById("InputBox_M").disabled = true;
            document.getElementById("InputBox_N").disabled = true;
            document.getElementById("Button_SetMN").disabled = true;
            return [M, N] ;
        }

        function resetMN()
        {
            var Canvas = document.getElementById("Canvas_For_Data") ;
            Canvas.getContext("2d").clearRect(0, 0, Canvas.width, Canvas.height);
            document.getElementById("InputBox_M").disabled = false;
            document.getElementById("InputBox_N").disabled = false;
            document.getElementById("Button_SetMN").disabled = false;
            var Text_M = document.getElementById("InputBox_M").value ;
            var Text_N = document.getElementById("InputBox_N").value ;
            var M = parseInt(Text_M) ;
            var N = parseInt(Text_N) ;
            deleteOldCheckBox(M) ;
            var pcvcheckbox = document.getElementById("Checkbox_For_PCV_Select");
            pcvcheckbox.checked = false ;
            return [M, N] ;
        }
        function sortWithIndex(InputArray) {
            var toSort = InputArray.slice(); ;
            for (var i = 0; i < toSort.length; i++) {
                toSort[i] = [InputArray[i], i];
            }
            toSort.sort(function(left, right) {
                return (left[0] <= right[0]) ? -1 : 1;
            });
            var sortIndices = numeric.linspace(0,InputArray.length-1);
            for (var j = 0; j < InputArray.length; j++) {
                sortIndices[j] =toSort[InputArray.length-1-j][1];
            }
            return sortIndices;
        }

        function sortedDrawData(Data, H, m, n, SortedIndex)
        {
            var UnitW = Math.floor(w / (3 * m + 1));
            var UnitH = Math.floor(2 * h / 3 / (n + 1));
            var FontSize = (UnitW<UnitH)?UnitW:UnitH ;
            if (arguments.length==4)
            {
                SortedIndex = numeric.linspace(0, m-1) ;
            }
            if (arguments.length==2)
            {
                m = H.length ;
                var sizeData = numeric.dim(Data);
                n = sizeData[1] ;
                SortedIndex = numeric.linspace(0, m-1) ;
            }
            var Canvas_For_Data = document.getElementById("Canvas_For_Data") ;
            var Canvas_For_Data_Draw = Canvas_For_Data.getContext("2d") ;
            Canvas_For_Data_Draw.clearRect(0, 0, Canvas_For_Data.width, Canvas_For_Data.height);
            for (var i=0; i<m; i++)
            {
                var local_i;
                local_i = SortedIndex[i];
                Canvas_For_Data_Draw.font = FontSize+"px Arial";
                Canvas_For_Data_Draw.textAlign = "center";
                Canvas_For_Data_Draw.fillText(H[local_i],(3*i+2)*UnitW, (0.5)*UnitH);
                var LocalData =numeric.rep([2, n], 0);
                LocalData[0]= Data[2*local_i] ;
                LocalData[1]= Data[2*local_i+1] ;
                for (j = 0 ; j<n; j++)
                {
                    var LocalColor = (LocalData[0][j] > 0.5) ? colorA:colorB ;
                    if(numeric.sum(LocalData) == 2*n)
                    {
                        LocalColor = colorH ;
                    }
                    Canvas_For_Data_Draw.fillStyle = LocalColor ;
                    Canvas_For_Data_Draw.fillRect   ((3*i+1)*UnitW, (j+1)*UnitH, UnitW, UnitH);
                    var LocalColor = (LocalData[1][j] > 0.5) ? colorA:colorB ;
                    if(numeric.sum(LocalData) == 2*n)
                    {
                        LocalColor = colorH ;
                    }
                    Canvas_For_Data_Draw.fillStyle = LocalColor ;
                    Canvas_For_Data_Draw.fillRect   ((3*i+2)*UnitW, (j+1)*UnitH, UnitW, UnitH);
                    Canvas_For_Data_Draw.fillStyle = colorC;
                    Canvas_For_Data_Draw.strokeRect ((3*i+1)*UnitW, (j+1)*UnitH, UnitW, UnitH);
                    Canvas_For_Data_Draw.strokeRect ((3*i+2)*UnitW, (j+1)*UnitH, UnitW, UnitH);
                }
                var Checkbox__For_Data = document.createElement('input');
                Checkbox__For_Data.type = "checkbox";
                Checkbox__For_Data.name = "name";
                Checkbox__For_Data.value = "value";
                Checkbox__For_Data.id = i+"_Checkbox__For_Data";
                Checkbox__For_Data.style.position = "absolute";
                Checkbox__For_Data.style.left     = (3*i+2)*UnitW-UnitW/2+"px";
                Checkbox__For_Data.style.top      = 1.05*h+"px";//UnitH+h/3+UnitH*(n+1)+"px";
                Checkbox__For_Data.height = UnitH ;
                Checkbox__For_Data.width  = UnitW*2 ;
                Checkbox__For_Data.checked = false ;
                Checkbox__For_Data.onclick = function() { scanCheckbox(m); };
                document.body.appendChild(Checkbox__For_Data);
            }
        }
        function reset(m , n)
        {
            if (arguments.length==0)
            {
                var m = 20 ;
                var n = 10;
            }
            var rawData = numeric.random([m,n]);
            var Data  = numeric.rep([2*m, n], 0);
            rawData = numeric.leq(rawData, 0.5);
            for (var i =0; i < m; i++)
            {
                Data[2*i  ] = rawData[i];
                Data[2*i+1] = rawData[i];
            }
            Data = FixedData ;
            var H = getH(Data, m, n);
            var SortedIndex = sortWithIndex(H) ;
            var sortedH = reindexData(H, SortedIndex) ;
            var sortedData = reindexData(Data, SortedIndex) ;
            drawData(sortedData, sortedH, m, n) ;
            var checkBox ;
            for (var i = 0; i<m; i++) {
                checkBox = document.getElementById(i+"_Checkbox__For_Data");
                checkBox.checked = false;
            }
            checkBox = document.getElementById("Checkbox_For_PCV_Select");
            checkBox.checked = false;
            var ReturnData = [];
            ReturnData.push(sortedData);
            ReturnData.push(sortedH);
            return ReturnData ;
        }
        function increase()
        {
            var Label = document. getElementById("Label") ;
            var text = Label.textContent;
            var thenum = Number(text.replace( /^\D+/g, ''));
            thenum = thenum + 1 ;
            Label.innerHTML = "G"+thenum ;
            reset() ;
        }
        function decrease()
        {
            var Label = document. getElementById("Label") ;
            var text = Label.textContent;
            var thenum = Number(text.replace( /^\D+/g, ''));
            thenum = thenum - 1 ;
            if (thenum<0)
                thenum = 0;
            Label.innerHTML = "G"+thenum ;
            reset () ;
        }
        function cross()
        {
            reset() ;
        }
        function NewData(m, n)
        {
            if (arguments.length==0)
            {
                var m = 20 ;
                var n = 10 ;
            }
            var Data = numeric.random([2*m,n]);
            for(var i = 0; i<m; i++)
                for (var j= 0; j < n; j++)
                    Data[2*i+1][j]=Data[2*i][j];
            return Data ;
        }
        function ComputeH(Data, m, n)
        {
            if (arguments.length==1)
            {
                var m = 20 ;
                var n = 10 ;
            }
            var Data = numeric.random([2*m,n]);
            for(var i = 0; i<m; i++)
                for (var j= 0; j < n; j++)
                    Data[2*i+1][j]=Data[2*i][j];
            return Data ;
        }
        function getH(Data, m, n)
        {
            if (arguments.length==1)
            {
                var sizeData = numeric.dim(Data);
                m = sizeData[0]/2;
                n = sizeData[1] ;
            }
            var H = numeric.rep([m], 0) ;
            for (var i = 0; i<m; i++)
            {
                H[i] = 5*(numeric.sum(Data[2*i])+numeric.sum(Data[2*i+1]) );
            }
            return H ;
        }
        function drawData(Data, H, m, n)
        {
            var UnitW = Math.floor(w / (3 * m + 1));
            var UnitH = Math.floor(2 * h / 3 / (n + 1));
            var FontSize = (UnitW<UnitH)?UnitW:UnitH ;
            if (arguments.length==4)
            {
                var SortedIndex = numeric.linspace(0, m-1) ;
            }
            if (arguments.length==2)
            {
                m = H.length ;
                var sizeData = numeric.dim(Data);
                n = sizeData[1] ;
                var SortedIndex = numeric.linspace(0, m-1) ;
            }
            var Canvas_For_Data = document.getElementById("Canvas_For_Data") ;
            var Canvas_For_Data_Draw = Canvas_For_Data.getContext("2d") ;
            Canvas_For_Data_Draw.clearRect(0, 0, Canvas_For_Data.width, Canvas_For_Data.height);
            for (i=0; i<m; i++)
            {
                var local_i;
                local_i = SortedIndex[i];
                Canvas_For_Data_Draw.font = FontSize+"px Arial";
                Canvas_For_Data_Draw.textAlign = "center";
                Canvas_For_Data_Draw.fillText(H[local_i],(3*i+2)*UnitW, (0.5)*UnitH);
                var LocalData =numeric.rep([2, n], 0);
                LocalData[0]= Data[2*local_i] ;
                LocalData[1]= Data[2*local_i+1] ;
                for (j = 0 ; j<n; j++)
                {
                    var LocalColor = (LocalData[0][j] > 0.5) ? colorA:colorB ;
                    if(numeric.sum(LocalData) == 2*n)
                    {
                        LocalColor = colorH ;
                    }
                    Canvas_For_Data_Draw.fillStyle = LocalColor ;
                    Canvas_For_Data_Draw.fillRect   ((3*i+1)*UnitW, (j+1)*UnitH, UnitW, UnitH);
                    var LocalColor = (LocalData[1][j] > 0.5) ? colorA:colorB ;
                    if(numeric.sum(LocalData) == 2*n)
                    {
                        LocalColor = colorH ;
                    }
                    Canvas_For_Data_Draw.fillStyle = LocalColor ;
                    Canvas_For_Data_Draw.fillRect   ((3*i+2)*UnitW, (j+1)*UnitH, UnitW, UnitH);
                    Canvas_For_Data_Draw.fillStyle = colorC;
                    Canvas_For_Data_Draw.strokeRect ((3*i+1)*UnitW, (j+1)*UnitH, UnitW, UnitH);
                    Canvas_For_Data_Draw.strokeRect ((3*i+2)*UnitW, (j+1)*UnitH, UnitW, UnitH);
                }
            }
        }

        function performCrossOperation(L1, L2, r, k)
        {
            var n_dim = numeric.dim(L1) ;
            var n = n_dim[1] ;
            var Offspring = numeric.rep([2*k, n], 0) ;
            var R = numeric.rep([n], 0.5);
            for (var i = 1 ; i<n; i++)
            {
                R[i] = i%2?0.1:0.2;
            }
            for (var i = 0; i<k ; i++)
            {
                var RandomArray_1 = numeric.random([n]) ;
                var RandomArray_2 = numeric.random([n]) ;
                var P1 = numeric.mod( cumsum(numeric.leq(RandomArray_1, R)), 2) ;
                var P2 = numeric.mod( cumsum(numeric.leq(RandomArray_2, R)), 2) ;
                for (var j = 0; j<n; j++)
                {
                    Offspring[2*i  ][j] = L1[P1[j]][j];
                    Offspring[2*i+1][j] = L2[P2[j]][j];
                }

            }
            return Offspring ;
        }
        function cumsum(Array_In)
        {
            var Array_Out = numeric.rep(numeric.dim(Array_In), 0) ;
            var temSum = 0;
            for (var i = 0; i<Array_In.length; i++)
            {
                temSum = temSum + Array_In[i] ;
                Array_Out[i] = temSum;
            }
            return Array_Out ;
        }
        function creditAppendix()
        {
            var AppendixText = ["Reference & Credit:\n" ,
                "[1]. Javascript Code Implemented by: Shuo XU, Ph.D, Email : ShuoXu@iastate.edu , st.charlie.xu@gmail.com",
                "[2]. WebStorm: The Smartest JavaScript IDE - JetBrains, https://www.jetbrains.com/webstorm/" ,
                "[3]. Numerical analysis in Javascript, http://www.numericjs.com/" ,
                "[4]. Ye Han, John N. Cameron, Lizhi Wang, William D. Beavis; The Predicted Cross Value for Genetic Introgression of Multiple Alleles" ];
            var Label_Appendix = document.createElement('label') ;
            Label_Appendix.style.font = h/40+"px Arial";
            Label_Appendix.style.position = "absolute" ;
            Label_Appendix.style.left     = 0+"px";
            Label_Appendix.style.top      = (1+1./7)*h+"px";
            Label_Appendix.style.height   = h/40 +"px";
            Label_Appendix.style.width    = w +"px";
            Label_Appendix.style.textAlign = "left";
            Label_Appendix.htmlFor = "id";
            Label_Appendix.id = "Label_Appendix" ;
            for (var i = 0; i<AppendixText.length; i++)
            {
                Label_Appendix.appendChild(document.createTextNode(AppendixText[i]));
                var br = document.createElement("br");
                Label_Appendix.appendChild(br);
            }
            document.body.appendChild(Label_Appendix);
        }
    </script>
</head>
<body  onload="main();">

</body>

</html>
